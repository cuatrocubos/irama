[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2023-05-15 00:09:51.103424",
  "module": "Irama",
  "name": "Generate Material Request",
  "script": "frappe.ui.form.on('Sales Order', {\n  onload_post_render(frm) {\n    frm.page.add_inner_button(\n      __('Ingreso Materiales Cliente'),\n      () => make_material_request(frm),\n      'Crear'\n    );\n  },\n});\n\nfunction make_material_request(frm) {\n  frm.call({\n    method: 'erpnext.selling.doctype.sales_order.sales_order.get_work_order_items()',\n    args: {\n      sales_order: frm.docname,\n    },\n    type: \"GET\",\n    freeze: true,\n    callback: function (r) {\n      if (!r.message) {\n        frappe.msgprint({\n          title: __('Stock Entry not created'),\n          message: __('No Items with Bill of Materials to Manufacture'),\n          indicator: 'orange',\n        });\n        return;\n      } else {\n        const fields = [\n          {\n            label: 'Items',\n            fieldtype: 'Table',\n            fieldname: 'items',\n            description: __('Select BOM and Qty for stock entry'),\n            fields: [\n              {\n                fieldtype: 'Read Only',\n                fieldname: 'item_code',\n                label: __('Item Code'),\n                in_list_view: 1,\n              },\n              {\n                fieldtype: 'Link',\n                fieldname: 'bom',\n                options: 'BOM',\n                reqd: 1,\n                label: __('Select BOM'),\n                in_list_view: 1,\n                get_query: function (doc) {\n                  return { filters: { item: doc.item_code } };\n                },\n              },\n              {\n                fiedtype: 'Float',\n                fieldname: 'pending_qty',\n                reqd: 1,\n                label: __('Qty'),\n                in_list_view: 1\n              },\n              {\n                field_type: 'Data',\n                fieldname: 'sales_order_item',\n                reqd: 1,\n                label: __('Sales Order Item'),\n                hidden: 1,\n              },\n            ],\n            data: r.message,\n            get_data: () => {\n              return r.message;\n            },\n          },\n        ];\n        var d = new frappe.ui.Dialog({\n          title: __('Select Items to create Stock Entry'),\n          fields: fields,\n          primary_action: function () {\n            var data = {\n              items: d.fields_dict.items.grid.get_selected_children(),\n            };\n            frm.call({\n              method: 'make_stock_entry_for_sales_order',\n              args: {\n                items: data,\n                company: frm.doc.company,\n                sales_order_id: frm.docname,\n                customer: frm.customer,\n              },\n              freeze: true,\n              callback: function (r) {\n                if (r.message) {\n                  frappe.msgprint({\n                    message: __('Stock Entry Created: {0}', [\n                      r.message\n                        .map(function(d) {\n                          return repl('<a href=\"/app/stock-entry/%(name)s\">%(name)s</a>', {name:d})\n\t\t\t\t\t\t\t\t\t\t\t\t}).join(', ')]),\n                    indicator: 'green',\n                  });\n                }\n                d.hide();\n              },\n            });\n          },\n          primary_action_label: __('Create'),\n        });\n        d.show();\n      }\n    },\n  });\n};\n",
  "view": "Form"
 }
]